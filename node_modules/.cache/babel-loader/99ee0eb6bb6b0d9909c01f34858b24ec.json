{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//DataGrid\nimport \"devextreme/dist/css/dx.light.css\";\nimport { Workbook } from \"exceljs\";\nimport saveAs from \"file-saver\";\nimport { exportDataGrid } from \"devextreme/excel_exporter\";\nimport moment from \"moment\";\nimport { DxDataGrid, DxSearchPanel, DxPaging, DxPager, DxScrolling, DxColumn // DxExport,\n} from \"devextreme-vue/data-grid\"; //API\n\nimport axios from \"/axios.js\"; //Pages & Structures\n\nimport toolbar from \"@/components/app-structures/app-toolbar.vue\";\nimport popupAdd from \"@/views/Applications/Record/Mileage/mileage-add.vue\";\nimport popupEdit from \"@/views/Applications/Record/Mileage/mileage-edit.vue\";\nimport contentLoading from \"@/components/app-structures/app-content-loading.vue\";\nimport previewImage from \"@/components/image-preview.vue\";\nimport clone from \"just-clone\";\nimport approvalBox from \"@/components/app-structures/app-item-approval.vue\";\nexport default {\n  name: \"ViewMileageList\",\n  components: {\n    toolbar,\n    DxDataGrid,\n    DxSearchPanel,\n    DxPaging,\n    DxPager,\n    DxScrolling,\n    DxColumn,\n    previewImage,\n    // DxExport,\n    contentLoading,\n    popupAdd,\n    popupEdit,\n    approvalBox\n  },\n\n  created() {\n    this.$store.commit(\"UPDATE_CURRENT_INAPP\", {\n      name: \"Mileage Record\",\n      icon: \"/img/icon_menu/record/mileage.png\"\n    });\n    this.FETCH_LIST();\n  },\n\n  data() {\n    return {\n      isAdd: false,\n      isEdit: false,\n      isLoading: false,\n      currentViewRow: 1,\n      errorMessage: \"\",\n      editInfo: \"\",\n      previewImg: \"\",\n      MileageList: \"\"\n    };\n  },\n\n  computed: {\n    start_date() {\n      if (this.currentViewRow.start_date) return moment(this.currentViewRow.start_date).format(\"LL\");else return \"\";\n    },\n\n    end_date() {\n      if (this.currentViewRow.end_date) return moment(this.currentViewRow.end_date).format(\"LL\");else return \"\";\n    },\n\n    baseURL() {\n      var mode = this.$store.state.mode;\n      if (mode == \"dev\") return this.$store.state.modeURL.dev;else if (mode == \"prod\") return this.$store.state.modeURL.prod;else return console.log(\"develpment mode set up incorrect.\");\n    }\n\n  },\n  methods: {\n    EXPORT_DATA(e) {\n      const workbook = new Workbook();\n      const worksheet = workbook.addWorksheet(\"Clients\");\n      exportDataGrid({\n        worksheet: worksheet,\n        component: e.component\n      }).then(function () {\n        workbook.xlsx.writeBuffer().then(function (buffer) {\n          saveAs(new Blob([buffer], {\n            type: \"application/octet-stream\"\n          }), \"Clients.xlsx\");\n        });\n      });\n      e.cancel = true;\n    },\n\n    VIEW_INFO(e) {\n      if (e.data) {\n        this.currentViewRow = e.data;\n        this.SCROLL_TOP_INFO();\n      }\n    },\n\n    CLEAR_VIEW_INFO() {\n      this.currentViewRow = \"\";\n    },\n\n    TOGGLE_POPUP(m) {\n      if (m == \"add\") {\n        if (this.isAdd == true) this.isAdd = false;else this.isAdd = true;\n      } else if (m == \"edit\") {\n        if (this.isEdit == true) this.isEdit = false;else {\n          this.editInfo = clone(this.currentViewRow);\n          this.isEdit = true;\n        }\n      }\n    },\n\n    FETCH_LIST() {\n      this.currentViewRow = 1;\n      this.isLoading = true;\n      axios({\n        method: \"get\",\n        url: \"/mile-record/mile-record-list\",\n        headers: {\n          Authorization: \"Bearer \" + JSON.parse(localStorage.getItem(\"token\"))\n        }\n      }).then(res => {\n        // console.log(res);\n        if (res.data) {\n          this.MileageList = res.data;\n          if (this.MileageList.length > 0) this.currentViewRow = this.MileageList[this.MileageList.length - 1];\n        }\n      }).catch(error => {\n        console.log(error);\n      }).finally(() => {\n        this.isLoading = false;\n      });\n    },\n\n    DELETE_ITEM() {\n      this.$ons.notification.confirm(\"Confirm delete?\").then(res => {\n        if (res == 1) {\n          axios({\n            method: \"delete\",\n            url: \"/mile-record/mile-record-delete\",\n            headers: {\n              Authorization: \"Bearer \" + JSON.parse(localStorage.getItem(\"token\"))\n            },\n            data: {\n              id_mile: this.currentViewRow.id_mile\n            }\n          }).then(res => {\n            console.log(res);\n\n            if (res.status == 200) {\n              this.$ons.notification.alert(\"Delete successful\");\n              this.FETCH_LIST();\n            }\n          }).catch(error => {\n            console.log(error);\n          }).finally(() => {});\n        }\n      });\n    },\n\n    SCROLL_TOP_INFO() {\n      document.getElementById(\"info-sidebar\").scroll({\n        top: 0,\n        behavior: \"smooth\"\n      });\n    },\n\n    PREVIEW_IMG(img) {\n      if (img) {\n        this.previewImg = img;\n      }\n    },\n\n    PREVIEW_IMG_CLOSE() {\n      this.previewImg = \"\";\n    },\n\n    APPROVE_BTN(option) {\n      var user = JSON.parse(localStorage.getItem(\"user\"));\n      var alertText = \"N/A\";\n      var data = {\n        id_mile: this.currentViewRow.id_mile,\n        approve_status: 0,\n        id_user: user.id_user //updater user\n\n      };\n\n      if (option == \"req_approve\") {\n        //send approve request 1--> 2\n        data.approve_status = 2;\n        alertText = \"Confirm Send Approve Request?\";\n      } else if (option == \"approve\") {\n        //feedback approve 2 --> 3\n        data.approve_status = 3;\n        alertText = \"Confirm Send Approve Feedback?\";\n      } else if (option == \"reject\") {\n        //feedback reject 2 --> 4\n        data.approve_status = 4;\n        alertText = \"Confirm Send Reject Feedback?\";\n      } else if (option == \"req_edit\") {\n        //feedback request edit 2 --> 5\n        data.approve_status = 5;\n        alertText = \"Confirm Send Request Edit Feedback?\";\n      }\n\n      this.$ons.notification.confirm(alertText).then(res => {\n        if (res == 1) {\n          axios({\n            method: \"put\",\n            url: \"/mile-record/mile-record-status\",\n            headers: {\n              Authorization: \"Bearer \" + JSON.parse(localStorage.getItem(\"token\"))\n            },\n            data: data\n          }).then(res => {\n            console.log(res);\n\n            if (res.status == 200) {\n              this.$ons.notification.alert(\"Approval Status Sent\");\n              this.FETCH_LIST();\n            }\n          }).catch(error => {\n            console.log(error);\n          }).finally(() => {});\n        }\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0RA;AACA;AACA;AACA;AACA;AACA;AACA,SACAA,UADA,EAEAC,aAFA,EAGAC,QAHA,EAIAC,OAJA,EAKAC,WALA,EAMAC,QANA,CAOA;AAPA,OAQA,0BARA,C,CAUA;;AACA,8B,CAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACAC,yBADA;AAEAC;AACAC,WADA;AAEAR,cAFA;AAGAC,iBAHA;AAIAC,YAJA;AAKAC,WALA;AAMAC,eANA;AAOAC,YAPA;AAQAI,gBARA;AASA;AACAC,kBAVA;AAWAC,YAXA;AAYAC,aAZA;AAaAC;AAbA,GAFA;;AAiBAC;AACA;AACAR,4BADA;AAEAS;AAFA;AAIA;AACA,GAvBA;;AAwBAC;AACA;AACAC,kBADA;AAEAC,mBAFA;AAGAC,sBAHA;AAIAC,uBAJA;AAKAC,sBALA;AAMAC,kBANA;AAOAC,oBAPA;AAQAC;AARA;AAUA,GAnCA;;AAoCAC;AACAC;AACA,0CACA,2DADA,KAEA;AACA,KALA;;AAMAC;AACA,wCACA,yDADA,KAEA;AACA,KAVA;;AAWAC;AACA;AACA,mEACA,+DACA;AACA;;AAhBA,GApCA;AAsDAC;AACAC;AACA;AACA;AACAC;AACAC,4BADA;AAEAC;AAFA,SAGAC,IAHA,CAGA;AACAC;AACAC,iBACA;AAAAC;AAAA,YADA,EAEA,cAFA;AAIA,SALA;AAMA,OAVA;AAWAC;AACA,KAhBA;;AAiBAC;AACA;AACA;AACA;AACA;AACA,KAtBA;;AAuBAC;AACA;AACA,KAzBA;;AA0BAC;AACA;AACA,wDACA;AACA,OAHA,MAGA;AACA,0DACA;AACA;AACA;AACA;AACA;AACA,KArCA;;AAsCAC;AACA;AACA;AACAC;AACAC,qBADA;AAEAC,4CAFA;AAGAC;AACAC;AADA;AAHA,SAOAb,IAPA,CAOAc;AACA;AACA;AACA;AACA,2CACA,sBACA,6CADA;AAEA;AACA,OAfA,EAgBAC,KAhBA,CAgBAC;AACAC;AACA,OAlBA,EAmBAC,OAnBA,CAmBA;AACA;AACA,OArBA;AAsBA,KA/DA;;AAgEAC;AACA;AACA;AACAV;AACAC,4BADA;AAEAC,kDAFA;AAGAC;AACAC,6BACA;AAFA,aAHA;AAOA/B;AACAsC;AADA;AAPA,aAWApB,IAXA,CAWAc;AACAG;;AACA;AACA;AACA;AACA;AACA,WAjBA,EAkBAF,KAlBA,CAkBAC;AACAC;AACA,WApBA,EAqBAC,OArBA,CAqBA,QArBA;AAsBA;AACA,OAzBA;AA0BA,KA3FA;;AA4FAG;AACAC,eACAC,cADA,CACA,cADA,EAEAC,MAFA,CAEA;AAAAC;AAAAC;AAAA,OAFA;AAGA,KAhGA;;AAiGAC;AACA;AACA;AACA;AACA,KArGA;;AAsGAC;AACA;AACA,KAxGA;;AAyGAC;AACA;AACA;AACA;AACAT,4CADA;AAEAU,yBAFA;AAGAC,6BAHA,CAGA;;AAHA;;AAKA;AACA;AACAjD;AACAkD;AACA,OAJA,MAIA;AACA;AACAlD;AACAkD;AACA,OAJA,MAIA;AACA;AACAlD;AACAkD;AACA,OAJA,MAIA;AACA;AACAlD;AACAkD;AACA;;AACA;AACA;AACAvB;AACAC,yBADA;AAEAC,kDAFA;AAGAC;AACAC,6BACA;AAFA,aAHA;AAOA/B;AAPA,aASAkB,IATA,CASAc;AACAG;;AACA;AACA;AACA;AACA;AACA,WAfA,EAgBAF,KAhBA,CAgBAC;AACAC;AACA,WAlBA,EAmBAC,OAnBA,CAmBA,QAnBA;AAoBA;AACA,OAvBA;AAwBA;;AA1JA;AAtDA","names":["DxDataGrid","DxSearchPanel","DxPaging","DxPager","DxScrolling","DxColumn","name","components","toolbar","previewImage","contentLoading","popupAdd","popupEdit","approvalBox","created","icon","data","isAdd","isEdit","isLoading","currentViewRow","errorMessage","editInfo","previewImg","MileageList","computed","start_date","end_date","baseURL","methods","EXPORT_DATA","exportDataGrid","worksheet","component","then","workbook","saveAs","type","e","VIEW_INFO","CLEAR_VIEW_INFO","TOGGLE_POPUP","FETCH_LIST","axios","method","url","headers","Authorization","res","catch","error","console","finally","DELETE_ITEM","id_mile","SCROLL_TOP_INFO","document","getElementById","scroll","top","behavior","PREVIEW_IMG","PREVIEW_IMG_CLOSE","APPROVE_BTN","approve_status","id_user","alertText"],"sourceRoot":"src/views/Applications/Record/Mileage","sources":["MileageList.vue"],"sourcesContent":["<template>\n  <div class=\"pm-page\">\n    <div class=\"pm-toolbar\">\n      <toolbar\n        pageName=\"Mileage Record\"\n        @refreshInfo=\"FETCH_LIST()\"\n        :isNewBtn=\"true\"\n        newBtnLabel=\"New Mile Record\"\n        @newBtnFn=\"TOGGLE_POPUP('add')\"\n      />\n    </div>\n    <div class=\"pm-page-container\">\n      <div class=\"page-content page-list\">\n        <DxDataGrid\n          id=\"contact-client-list\"\n          :data-source=\"MileageList\"\n          :selection=\"{ mode: 'single' }\"\n          :hover-state-enabled=\"true\"\n          :allow-column-reordering=\"false\"\n          :show-borders=\"true\"\n          :show-row-lines=\"false\"\n          :row-alternation-enabled=\"true\"\n          @exporting=\"EXPORT_DATA\"\n        >\n          <DxColumn\n            data-field=\"record_no\"\n            caption=\"Record No.\"\n            alignment=\"left\"\n            sort-order=\"desc\"\n          />\n          <DxColumn\n            data-field=\"created_by_name\"\n            caption=\"Created By\"\n            alignment=\"left\"\n          />\n          <DxColumn\n            data-field=\"start_date\"\n            data-type=\"date\"\n            format=\"dd MMM, yyyy\"\n            caption=\"Start Date\"\n          />\n          <!-- <DxColumn\n            data-field=\"start_mile\"\n            caption=\"Start Mile\"\n            alignment=\"left\"\n          /> -->\n          <DxColumn\n            data-field=\"end_date\"\n            data-type=\"date\"\n            format=\"dd MMM, yyyy\"\n            caption=\"End Date\"\n          />\n          <!-- <DxColumn data-field=\"end_mile\" caption=\"End Mile\" alignment=\"left\" /> -->\n          <DxColumn\n            data-field=\"total_mile\"\n            caption=\"Total Mile\"\n            alignment=\"left\"\n          />\n          <DxColumn\n            caption=\"Approval Status\"\n            alignment=\"center\"\n            :width=\"150\"\n            cell-template=\"approval-status\"\n          />\n          <DxColumn :width=\"50\" caption=\"\" cell-template=\"option-btn-set\" />\n          <template #approval-status=\"{ data }\">\n            <div class=\"approval-incolumn\">\n              <div class=\"blue\" v-if=\"data.data.approve_status == 1\">\n                <span>{{ data.data.status_desc }}</span>\n              </div>\n              <div class=\"orange\" v-if=\"data.data.approve_status == 2\">\n                <i class=\"las la-clock\"></i>\n                <span>{{ data.data.status_desc }}</span>\n              </div>\n              <div class=\"green\" v-if=\"data.data.approve_status == 3\">\n                <i class=\"las la-check-double\"></i>\n                <span>{{ data.data.status_desc }}</span>\n              </div>\n              <div class=\"red\" v-if=\"data.data.approve_status == 4\">\n                <i class=\"las la-times\"></i>\n                <span>{{ data.data.status_desc }}</span>\n              </div>\n              <div class=\"red\" v-if=\"data.data.approve_status == 5\">\n                <i class=\"las la-pen\"></i>\n                <span>{{ data.data.status_desc }}</span>\n              </div>\n            </div>\n          </template>\n\n          <template #option-btn-set=\"{ data }\">\n            <div class=\"table-btn-group\">\n              <div class=\"table-btn\" v-on:click=\"VIEW_INFO(data)\">\n                <i class=\"las la-search blue\"></i>\n              </div>\n              <!-- <div class=\"table-btn\" v-on:click=\"TOGGLE_POPUP('edit', data)\">\n                <i class=\"las la-pen green\"></i>\n              </div>\n              <div class=\"table-btn\" v-on:click=\"DELETE_CLIENT(data)\">\n                <i class=\"las la-trash red\"></i>\n              </div> -->\n            </div>\n          </template>\n          <!-- Configuration goes here -->\n          <!-- <DxFilterRow :visible=\"true\" /> -->\n          <DxScrolling mode=\"standard\" />\n          <DxSearchPanel :visible=\"true\" />\n          <DxPaging :page-size=\"10\" :page-index=\"0\" />\n          <DxPager\n            :show-page-size-selector=\"true\"\n            :allowed-page-sizes=\"[5, 10, 20]\"\n            :show-navigation-buttons=\"true\"\n            :show-info=\"true\"\n            info-text=\"Page {0} of {1} ({2} items)\"\n          />\n          <!-- <DxExport :enabled=\"true\" /> -->\n        </DxDataGrid>\n      </div>\n      <div\n        class=\"page-content page-info border-left\"\n        v-if=\"currentViewRow != 1\"\n      >\n        <div id=\"info-sidebar\" class=\"pm-info-sidebar form\">\n          <approvalBox\n            :status=\"this.currentViewRow.approve_status\"\n            @btnRequestApprove=\"APPROVE_BTN('req_approve')\"\n            @btnApprove=\"APPROVE_BTN('approve')\"\n            @btnReject=\"APPROVE_BTN('reject')\"\n            @btnRequestEdit=\"APPROVE_BTN('req_edit')\"\n            @btnResendApprove=\"APPROVE_BTN('req_approve')\"\n            v-if=\"\n              this.currentViewRow.created_by ==\n                this.$store.state.user.id_user ||\n              this.$store.state.user.role == 'manager'\n            \"\n          />\n          <p class=\"pm-section-label\">Details</p>\n          <div class=\"form-item-container\">\n            <div class=\"input-set\" v-if=\"currentViewRow.record_no\">\n              <p class=\"label\">Record No:</p>\n              <p class=\"info\">\n                {{ currentViewRow.record_no }}\n              </p>\n            </div>\n            <div class=\"input-set\" v-if=\"currentViewRow.created_by_name\">\n              <p class=\"label\">Created By:</p>\n              <p class=\"info\">\n                {{ currentViewRow.created_by_name }}\n              </p>\n            </div>\n\n            <div class=\"input-set\">\n              <p class=\"label\">Start Date:</p>\n              <p class=\"info\">\n                {{ start_date }}\n              </p>\n            </div>\n            <div class=\"input-set\" v-if=\"currentViewRow.start_mile\">\n              <p class=\"label\">Start Mile:</p>\n              <p class=\"info\">\n                {{ currentViewRow.start_mile }}<span> km</span>\n              </p>\n            </div>\n            <div class=\"input-set\" v-if=\"currentViewRow.end_date\">\n              <p class=\"label\">End Date:</p>\n              <p class=\"info\">\n                {{ end_date }}\n              </p>\n            </div>\n            <div class=\"input-set\" v-if=\"currentViewRow.end_mile\">\n              <p class=\"label\">End Mile:</p>\n              <p class=\"info\">{{ currentViewRow.end_mile }}<span> km</span></p>\n            </div>\n            <div class=\"input-set\" v-if=\"currentViewRow.total_mile\">\n              <p class=\"label\">Total Mile:</p>\n              <p class=\"info\">\n                {{ currentViewRow.total_mile }}<span> km</span>\n              </p>\n            </div>\n          </div>\n          <p class=\"pm-section-label\">Attachments</p>\n          <div class=\"form-item-container\">\n            <div class=\"input-set\">\n              <p class=\"label\">Start Mile Image:</p>\n              <div class=\"img-box\">\n                <v-ons-toolbar-button\n                  class=\"btn-preview\"\n                  v-on:click=\"PREVIEW_IMG(currentViewRow.start_img)\"\n                  v-if=\"currentViewRow.start_img != null\"\n                >\n                  <i class=\"las la-expand-arrows-alt\"></i>\n                </v-ons-toolbar-button>\n                <img\n                  :src=\"this.baseURL + currentViewRow.start_img\"\n                  v-if=\"currentViewRow.start_img\"\n                />\n                <i class=\"las la-image\" v-if=\"!currentViewRow.start_img\"></i>\n                <label v-if=\"!currentViewRow.start_img\">No Image</label>\n              </div>\n            </div>\n\n            <div class=\"input-set\">\n              <p class=\"label\">End Mile Image:</p>\n              <div class=\"img-box\">\n                <v-ons-toolbar-button\n                  class=\"btn-preview\"\n                  v-on:click=\"PREVIEW_IMG(currentViewRow.end_img)\"\n                  v-if=\"currentViewRow.end_img != null\"\n                >\n                  <i class=\"las la-expand-arrows-alt\"></i>\n                </v-ons-toolbar-button>\n                <img\n                  :src=\"this.baseURL + currentViewRow.end_img\"\n                  v-if=\"currentViewRow.end_img\"\n                />\n                <i class=\"las la-image\" v-if=\"!currentViewRow.end_img\"></i>\n                <label v-if=\"!currentViewRow.end_img\">No Image</label>\n              </div>\n            </div>\n          </div>\n          <div\n            class=\"form-button-container\"\n            v-if=\"\n              this.$store.state.user.role == 'staff' &&\n              this.currentViewRow.created_by == this.$store.state.user.id_user\n            \"\n          >\n            <div\n              class=\"button-set info-button-set\"\n              v-if=\"\n                this.currentViewRow.approve_status == 1 ||\n                this.currentViewRow.approve_status == 5\n              \"\n            >\n              <v-ons-toolbar-button v-on:click=\"TOGGLE_POPUP('edit')\">\n                <i class=\"las la-pen\"></i>\n                <span>Edit</span>\n              </v-ons-toolbar-button>\n              <v-ons-toolbar-button class=\"red\" v-on:click=\"DELETE_ITEM()\">\n                <i class=\"las la-trash\"></i>\n                <span>Delete</span>\n              </v-ons-toolbar-button>\n            </div>\n          </div>\n          <div\n            class=\"form-button-container\"\n            v-if=\"this.$store.state.user.role == 'manager'\"\n          >\n            <div class=\"button-set info-button-set\">\n              <v-ons-toolbar-button class=\"red\" v-on:click=\"DELETE_ITEM()\">\n                <i class=\"las la-trash\"></i>\n                <span>Delete</span>\n              </v-ons-toolbar-button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <popupAdd\n      v-if=\"isAdd == true\"\n      @btn-cancel-add=\"TOGGLE_POPUP('add')\"\n      @refreshList=\"FETCH_LIST()\"\n    />\n    <popupEdit\n      v-if=\"isEdit == true\"\n      @btn-cancel-edit=\"TOGGLE_POPUP('edit')\"\n      @refreshList=\"FETCH_LIST()\"\n      v-bind:editInfo=\"editInfo\"\n    />\n    <contentLoading\n      text=\"Loading, please wait...\"\n      v-if=\"isLoading == true\"\n      color=\"#fc9b21\"\n    />\n    <previewImage\n      :imageURL=\"previewImg\"\n      v-if=\"previewImg\"\n      @close-preview=\"PREVIEW_IMG_CLOSE()\"\n    />\n  </div>\n</template> \n\n<script>\n//DataGrid\nimport \"devextreme/dist/css/dx.light.css\";\nimport { Workbook } from \"exceljs\";\nimport saveAs from \"file-saver\";\nimport { exportDataGrid } from \"devextreme/excel_exporter\";\nimport moment from \"moment\";\nimport {\n  DxDataGrid,\n  DxSearchPanel,\n  DxPaging,\n  DxPager,\n  DxScrolling,\n  DxColumn,\n  // DxExport,\n} from \"devextreme-vue/data-grid\";\n\n//API\nimport axios from \"/axios.js\";\n\n//Pages & Structures\nimport toolbar from \"@/components/app-structures/app-toolbar.vue\";\nimport popupAdd from \"@/views/Applications/Record/Mileage/mileage-add.vue\";\nimport popupEdit from \"@/views/Applications/Record/Mileage/mileage-edit.vue\";\nimport contentLoading from \"@/components/app-structures/app-content-loading.vue\";\nimport previewImage from \"@/components/image-preview.vue\";\nimport clone from \"just-clone\";\nimport approvalBox from \"@/components/app-structures/app-item-approval.vue\";\n\nexport default {\n  name: \"ViewMileageList\",\n  components: {\n    toolbar,\n    DxDataGrid,\n    DxSearchPanel,\n    DxPaging,\n    DxPager,\n    DxScrolling,\n    DxColumn,\n    previewImage,\n    // DxExport,\n    contentLoading,\n    popupAdd,\n    popupEdit,\n    approvalBox,\n  },\n  created() {\n    this.$store.commit(\"UPDATE_CURRENT_INAPP\", {\n      name: \"Mileage Record\",\n      icon: \"/img/icon_menu/record/mileage.png\",\n    });\n    this.FETCH_LIST();\n  },\n  data() {\n    return {\n      isAdd: false,\n      isEdit: false,\n      isLoading: false,\n      currentViewRow: 1,\n      errorMessage: \"\",\n      editInfo: \"\",\n      previewImg: \"\",\n      MileageList: \"\",\n    };\n  },\n  computed: {\n    start_date() {\n      if (this.currentViewRow.start_date)\n        return moment(this.currentViewRow.start_date).format(\"LL\");\n      else return \"\";\n    },\n    end_date() {\n      if (this.currentViewRow.end_date)\n        return moment(this.currentViewRow.end_date).format(\"LL\");\n      else return \"\";\n    },\n    baseURL() {\n      var mode = this.$store.state.mode;\n      if (mode == \"dev\") return this.$store.state.modeURL.dev;\n      else if (mode == \"prod\") return this.$store.state.modeURL.prod;\n      else return console.log(\"develpment mode set up incorrect.\");\n    },\n  },\n  methods: {\n    EXPORT_DATA(e) {\n      const workbook = new Workbook();\n      const worksheet = workbook.addWorksheet(\"Clients\");\n      exportDataGrid({\n        worksheet: worksheet,\n        component: e.component,\n      }).then(function () {\n        workbook.xlsx.writeBuffer().then(function (buffer) {\n          saveAs(\n            new Blob([buffer], { type: \"application/octet-stream\" }),\n            \"Clients.xlsx\"\n          );\n        });\n      });\n      e.cancel = true;\n    },\n    VIEW_INFO(e) {\n      if (e.data) {\n        this.currentViewRow = e.data;\n        this.SCROLL_TOP_INFO();\n      }\n    },\n    CLEAR_VIEW_INFO() {\n      this.currentViewRow = \"\";\n    },\n    TOGGLE_POPUP(m) {\n      if (m == \"add\") {\n        if (this.isAdd == true) this.isAdd = false;\n        else this.isAdd = true;\n      } else if (m == \"edit\") {\n        if (this.isEdit == true) this.isEdit = false;\n        else {\n          this.editInfo = clone(this.currentViewRow);\n          this.isEdit = true;\n        }\n      }\n    },\n    FETCH_LIST() {\n      this.currentViewRow = 1;\n      this.isLoading = true;\n      axios({\n        method: \"get\",\n        url: \"/mile-record/mile-record-list\",\n        headers: {\n          Authorization: \"Bearer \" + JSON.parse(localStorage.getItem(\"token\")),\n        },\n      })\n        .then((res) => {\n          // console.log(res);\n          if (res.data) {\n            this.MileageList = res.data;\n            if (this.MileageList.length > 0)\n              this.currentViewRow =\n                this.MileageList[this.MileageList.length - 1];\n          }\n        })\n        .catch((error) => {\n          console.log(error);\n        })\n        .finally(() => {\n          this.isLoading = false;\n        });\n    },\n    DELETE_ITEM() {\n      this.$ons.notification.confirm(\"Confirm delete?\").then((res) => {\n        if (res == 1) {\n          axios({\n            method: \"delete\",\n            url: \"/mile-record/mile-record-delete\",\n            headers: {\n              Authorization:\n                \"Bearer \" + JSON.parse(localStorage.getItem(\"token\")),\n            },\n            data: {\n              id_mile: this.currentViewRow.id_mile,\n            },\n          })\n            .then((res) => {\n              console.log(res);\n              if (res.status == 200) {\n                this.$ons.notification.alert(\"Delete successful\");\n                this.FETCH_LIST();\n              }\n            })\n            .catch((error) => {\n              console.log(error);\n            })\n            .finally(() => {});\n        }\n      });\n    },\n    SCROLL_TOP_INFO() {\n      document\n        .getElementById(\"info-sidebar\")\n        .scroll({ top: 0, behavior: \"smooth\" });\n    },\n    PREVIEW_IMG(img) {\n      if (img) {\n        this.previewImg = img;\n      }\n    },\n    PREVIEW_IMG_CLOSE() {\n      this.previewImg = \"\";\n    },\n    APPROVE_BTN(option) {\n      var user = JSON.parse(localStorage.getItem(\"user\"));\n      var alertText = \"N/A\";\n      var data = {\n        id_mile: this.currentViewRow.id_mile,\n        approve_status: 0,\n        id_user: user.id_user, //updater user\n      };\n      if (option == \"req_approve\") {\n        //send approve request 1--> 2\n        data.approve_status = 2;\n        alertText = \"Confirm Send Approve Request?\";\n      } else if (option == \"approve\") {\n        //feedback approve 2 --> 3\n        data.approve_status = 3;\n        alertText = \"Confirm Send Approve Feedback?\";\n      } else if (option == \"reject\") {\n        //feedback reject 2 --> 4\n        data.approve_status = 4;\n        alertText = \"Confirm Send Reject Feedback?\";\n      } else if (option == \"req_edit\") {\n        //feedback request edit 2 --> 5\n        data.approve_status = 5;\n        alertText = \"Confirm Send Request Edit Feedback?\";\n      }\n      this.$ons.notification.confirm(alertText).then((res) => {\n        if (res == 1) {\n          axios({\n            method: \"put\",\n            url: \"/mile-record/mile-record-status\",\n            headers: {\n              Authorization:\n                \"Bearer \" + JSON.parse(localStorage.getItem(\"token\")),\n            },\n            data: data,\n          })\n            .then((res) => {\n              console.log(res);\n              if (res.status == 200) {\n                this.$ons.notification.alert(\"Approval Status Sent\");\n                this.FETCH_LIST();\n              }\n            })\n            .catch((error) => {\n              console.log(error);\n            })\n            .finally(() => {});\n        }\n      });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"@/style/main.scss\";\n.pm-page {\n  border: 1px solid #e6e6e6;\n  border-width: 0 0 0 1px;\n  background-color: #ffffff;\n  height: 100%;\n  // display: grid;\n  // grid-template-rows: 61px auto;\n  // grid-template-columns: auto 360px;\n\n  .pm-page-container {\n    background-color: #ffffff;\n    // padding: 20px 20px 0px 20px;\n    height: calc(100vh - 180px);\n    display: flex;\n\n    .page-content {\n      width: 100%;\n      height: 100%;\n      margin: 0 auto;\n    }\n    .page-nodata {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    .page-list {\n      width: auto;\n      padding: 20px 20px 0 20px;\n    }\n    .page-info {\n      width: auto;\n    }\n  }\n}\n\n.pm-toolbar {\n  grid-column: span 2;\n}\n.border-left {\n  border: 1px solid #e6e6e6;\n  border-width: 0 0 0 1px;\n  padding: 0 !important;\n  height: calc(100vh - 139px) !important;\n}\n.pm-info-sidebar {\n  width: 360px;\n  height: 100%;\n  background: #fff;\n  padding: 0 20px;\n  overflow-y: scroll;\n  position: relative;\n  .pm-section-label {\n    font-style: normal;\n    font-weight: 600;\n    font-size: 1.75em;\n    line-height: 16px;\n    letter-spacing: -0.08px;\n    color: $web-font-color-black;\n    padding: 20px 0 10px 0;\n    margin: 0;\n    user-select: text;\n  }\n  .form-item-container {\n    display: block;\n  }\n  .pm-sidebar-close-btn {\n    width: 40px;\n    height: 20px;\n    position: absolute;\n    top: 20px;\n    right: 20px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background: #f3f0f0;\n    border-radius: 20px;\n    cursor: pointer;\n    i {\n      font-size: 1.75em;\n    }\n  }\n\n  .pm-sidebar-close-btn:hover {\n    background: #f6f6f6;\n  }\n  .pm-sidebar-close-btn:active {\n    background: #f3f0f0;\n  }\n}\n\n.pm-info-sidebar::-webkit-scrollbar {\n  display: none;\n}\n\n.form-item-container:last-child {\n  margin-bottom: 40px;\n}\n</style>"]},"metadata":{},"sourceType":"module"}